<!DOCTYPE html>
<html lang="pt-BR">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17483604386"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-17483604386');
</script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Conteúdo — Ze.EFE</title>
  <link rel="stylesheet" href="/style.css?v=20241222" />
</head>
<body>
  <header class="site-header">
    <div class="site-header-inner">
      <div class="site-header-left">
        <a href="/index.html" class="site-logo">
          <img src="img/logo.jpg" alt="Ze.EFE" />
        </a>
        <nav class="site-nav">
          <a href="/salas.html">Salas</a>
          <a href="/workshops.html">Cursos</a>
          <a href="/conteudos.html" aria-current="page">Conteúdos</a>
          <a href="/quemsomos.html">Quem somos</a>
        </nav>
      </div>
      <div class="site-header-actions">
        <a href="/index.html#contato" class="site-link">Contato</a>
        <div class="site-header-guest" id="homeHeaderGuest" data-zeefe-header="guest">
          <button class="btn btn-outline" type="button" id="openLoginChoice" data-zeefe-header-btn="login">Entrar</button>
        </div>
        <div class="site-header-user" id="homeHeaderAccount" data-zeefe-header="account" hidden>
          <button class="user-menu-trigger" type="button" id="homeHeaderAccountBtn" data-zeefe-header-btn="account" aria-haspopup="true" aria-expanded="false">
            <span id="homeHeaderAccountLabel" data-zeefe-header-label="account">Minha Conta</span>
          </button>
          <div class="user-menu-dropdown" id="homeHeaderAccountMenu" role="menu">
            <p class="user-menu-label" id="homeHeaderUserLabel" data-zeefe-header-label="user"></p>
            <button type="button" class="user-menu-item" id="homeHeaderPortal" data-zeefe-header-btn="portal">Ir para o portal</button>
            <button type="button" class="user-menu-item user-menu-danger" id="homeHeaderLogout" data-zeefe-header-btn="logout">Sair</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <article class="landing-section">
      <header class="section-heading">
        <h3 id="postTitle">Conteúdo</h3>
        <p id="postMeta"></p>
        <div class="post-share" id="postShare" hidden>
          <button type="button" class="btn btn-secondary btn-sm btn-icon" id="shareWhatsappBtn" aria-label="Compartilhar no WhatsApp">
            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M16 3C9.4 3 4 8.2 4 14.7c0 2.3.7 4.4 1.9 6.2L4 29l8.4-1.9c1.7.9 3.7 1.4 5.6 1.4 6.6 0 12-5.2 12-11.7C30 8.2 22.6 3 16 3zm0 21.3c-1.6 0-3.2-.4-4.6-1.2l-.7-.4-5 .9 1-4.7-.5-.8c-1-1.5-1.5-3.2-1.5-5 0-5 4.1-9 9.3-9 5.1 0 9.3 4 9.3 8.9s-4.1 9.3-9.3 9.3zm5.4-6.6c-.3-.1-1.7-.8-1.9-.9-.3-.1-.5-.1-.7.1-.2.3-.8.9-1 .9-.2.1-.4.1-.7 0-.3-.1-1.2-.4-2.2-1.3-.8-.7-1.3-1.6-1.5-1.9-.1-.3 0-.5.1-.6.1-.1.3-.3.4-.5.1-.2.1-.3.2-.5.1-.2 0-.4 0-.5 0-.1-.7-1.6-.9-2.2-.2-.6-.5-.5-.7-.5h-.6c-.2 0-.5.1-.7.3-.2.2-1 .9-1 2.3 0 1.3 1 2.6 1.1 2.8.1.2 2 3 4.8 4.2.7.3 1.2.5 1.6.6.7.2 1.3.2 1.7.1.5-.1 1.7-.7 1.9-1.4.2-.7.2-1.2.1-1.3-.1-.1-.3-.2-.6-.3z"/>
            </svg>
          </button>
          <div class="share-menu">
            <button type="button" class="btn btn-secondary btn-sm btn-icon" id="shareMenuToggle" aria-label="Compartilhar">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M18 16a2.9 2.9 0 0 0-1.8.7l-6.2-3.2a3 3 0 0 0 0-1l6.2-3.2A3 3 0 1 0 15 7a3 3 0 0 0 .1.7L9 10.9A3 3 0 1 0 9 14l6.1 3.2A3 3 0 1 0 18 16z"/>
              </svg>
            </button>
            <div class="share-menu-panel" id="shareMenuPanel" hidden>
              <button type="button" data-share="x">X</button>
              <button type="button" data-share="facebook">Facebook</button>
              <button type="button" data-share="linkedin">LinkedIn</button>
              <button type="button" data-share="email">E-mail</button>
              <button type="button" data-share="copy">Copiar link</button>
            </div>
          </div>
        </div>
      </header>
      <div id="postBody" class="post-body">
        <p>Carregando conteúdo...</p>
      </div>
    </article>
  </main>

  <footer class="site-footer">
    <div class="site-footer-inner">
      <div class="footer-column footer-map">
        <h3>Mapa do site</h3>
        <div class="footer-links-grid">
          <div>
            <h4>Salas</h4>
            <a href="/salas.html">Ver todas as salas</a>
          </div>
          <div>
            <h4>Cursos</h4>
            <a href="/workshops.html">Agenda de cursos e workshops</a>
          </div>
          <div>
            <h4>Área do Cliente</h4>
            <a href="/clientes.html">Reservas e visitantes</a>
          </div>
          <div>
            <h4>Anunciante</h4>
            <a href="/anunciante.html">Cadastrar salas e cursos</a>
          </div>
        </div>
      </div>
      <div class="footer-column footer-contact">
        <h3>Contato</h3>
        <p>contato@zeefe.com | <a href="https://wa.me/11922293332?text=Olá,%20gostaria%20de%20mais%20informações.">(11) 9.2229-3332</a></p>
        <p>Moema, São Paulo - SP</p>
        <p><a href="https://www.instagram.com/zeefe_brasil/">Instagram</a> | <a href="https://www.linkedin.com/company/zeefe/about/?viewAsMember=true">LinkedIn</a></p>
      </div>
    </div>
    <div class="site-footer-bottom">
      <div class="footer-powered">
        <span>Powered by</span>
        <div class="footer-powered-logos">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='110' height='30'><text x='5' y='20' font-family='Arial' font-size='16' fill='%23005CAB'>HostGator</text></svg>" alt="HostGator" loading="lazy">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='130' height='30'><text x='5' y='20' font-family='Arial' font-size='16' fill='%2300317A'>Contabilizei</text></svg>" alt="Contabilizei" loading="lazy">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='110' height='30'><text x='5' y='20' font-family='Arial' font-size='16' fill='%2300B376'>Stripe</text></svg>" alt="Stripe" loading="lazy">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='30'><text x='5' y='20' font-family='Arial' font-size='16' fill='%23E10D5C'>cora</text></svg>" alt="Cora" loading="lazy">
        </div>
      </div>
      <p>© 2025 Ze.EFE - Todos os direitos reservados</p>
    </div>
  </footer>

  <div class="modal-overlay" id="entryChoiceModal" aria-hidden="true">
    <div class="modal-dialog modal-small" role="dialog" aria-modal="true" aria-labelledby="entryChoiceTitle">
      <button class="modal-close" type="button" id="entryChoiceClose" aria-label="Fechar">&times;</button>
      <div class="modal-body">
        <div class="modal-info">
          <h2 id="entryChoiceTitle">Como você prefere entrar?</h2>
          <div class="entry-choice-grid">
            <button type="button" class="btn btn-primary entry-choice-btn" data-destino="/clientes.html">
              Sou cliente
            </button>
            <button type="button" class="btn btn-secondary entry-choice-btn" data-destino="/anunciante.html">
              Sou anunciante
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search || '');
      const id = params.get('id');
      if (!id) return;
      try {
        const res = await fetch('api/apiget.php?table=posts');
        const json = await res.json();
        if (!json.success) return;
        const posts = json.data || [];
        const post = posts.find(p => String(p.id) === String(id));
        if (!post) return;
        const titleEl = document.getElementById('postTitle');
        const metaEl = document.getElementById('postMeta');
        const bodyEl = document.getElementById('postBody');
        if (titleEl) titleEl.textContent = post.title || 'Conteúdo';
        const now = new Date();
        const status = (post.status || '').toLowerCase();
        const publishedAt = post.published_at ? new Date(post.published_at) : null;
        const isPublished = status === 'publicado' && (!publishedAt || !Number.isNaN(publishedAt.getTime()) && publishedAt <= now);

        if (!isPublished) {
          if (bodyEl) {
            bodyEl.innerHTML = '<p class="rooms-message">Este conteúdo está programado e ficará disponível na data de publicação.</p>';
          }
          return;
        }

        if (metaEl) {
          const parts = [];
          if (post.category_name || post.category) parts.push(post.category_name || post.category);
          if (post.published_at) parts.push(new Date(post.published_at).toLocaleString('pt-BR'));
          metaEl.textContent = parts.join(' • ');
        }
        if (bodyEl) {
          bodyEl.innerHTML = '';

          // Imagem de capa, quando houver
          const normalizeCoverPath = (path) => {
            const raw = String(path || '').trim();
            if (!raw) return '';
            if (raw.startsWith('data:')) return raw;
            if (/^https?:\/\//i.test(raw)) return raw;
            const idx = raw.indexOf('/img/posts/');
            if (idx !== -1) return raw.slice(idx);
            if (raw.startsWith('img/')) return raw;
            if (raw.startsWith('/')) return raw;
            return '/' + raw;
          };
          const attachCover = (img, rawPath, wrap, alt) => {
            const primary = normalizeCoverPath(rawPath);
            if (!primary) return false;
            img.alt = alt;
            img.src = primary;
            let fallback = '';
            if (!/^https?:\/\//i.test(primary) && !primary.startsWith('data:')) {
              fallback = primary.startsWith('/') ? primary.slice(1) : '/' + primary;
            }
            img.addEventListener('error', () => {
              if (fallback) {
                img.src = fallback;
                fallback = '';
                return;
              }
              img.remove();
              wrap.classList.add('is-missing');
              wrap.textContent = 'Imagem indisponível';
            });
            return true;
          };

          if (post.cover_path) {
            const coverWrap = document.createElement('div');
            coverWrap.className = 'post-cover';
            const img = document.createElement('img');
            if (attachCover(img, post.cover_path, coverWrap, post.title || 'Imagem deste conteúdo')) {
              coverWrap.appendChild(img);
            }
            bodyEl.appendChild(coverWrap);
          }

          const contentWrap = document.createElement('div');
          contentWrap.className = 'post-content';
          contentWrap.innerHTML = post.content || '';
          bodyEl.appendChild(contentWrap);
        }

        const postShare = document.getElementById('postShare');
        const shareWhatsappBtn = document.getElementById('shareWhatsappBtn');
        const shareMenuToggle = document.getElementById('shareMenuToggle');
        const shareMenuPanel = document.getElementById('shareMenuPanel');
        const shareTitle = post.title || 'Conteúdo Ze.EFE';
        const shareUrl = window.location.href;
        if (postShare) postShare.hidden = false;

        const openShareWindow = (url) => window.open(url, '_blank', 'noopener');

        shareWhatsappBtn?.addEventListener('click', () => {
          const text = encodeURIComponent(`${shareTitle} ${shareUrl}`);
          openShareWindow(`https://web.whatsapp.com/send?text=${text}`);
        });

        shareMenuToggle?.addEventListener('click', () => {
          shareMenuPanel.hidden = !shareMenuPanel.hidden;
        });

        shareMenuPanel?.addEventListener('click', (event) => {
          const btn = event.target.closest('button[data-share]');
          if (!btn) return;
          const type = btn.dataset.share;
          const title = encodeURIComponent(shareTitle);
          const url = encodeURIComponent(shareUrl);
          if (type === 'x') {
            openShareWindow(`https://twitter.com/intent/tweet?text=${title}&url=${url}`);
          } else if (type === 'facebook') {
            openShareWindow(`https://www.facebook.com/sharer/sharer.php?u=${url}`);
          } else if (type === 'linkedin') {
            openShareWindow(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`);
          } else if (type === 'email') {
            window.location.href = `mailto:?subject=${title}&body=${url}`;
          } else if (type === 'copy') {
            navigator.clipboard?.writeText(shareUrl).then(() => {
              btn.textContent = 'Link copiado!';
              setTimeout(() => { btn.textContent = 'Copiar link'; }, 1200);
            });
          }
          shareMenuPanel.hidden = true;
        });

        document.addEventListener('click', (event) => {
          if (!shareMenuPanel || shareMenuPanel.hidden) return;
          if (shareMenuPanel.contains(event.target) || shareMenuToggle?.contains(event.target)) return;
          shareMenuPanel.hidden = true;
        });

        // Incrementa contador de visualizações (somente se encontrar o post)
        try {
          await fetch('api/post_increment_view.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: post.id })
          });
        } catch (e) {
          // Falha silenciosa: não bloqueia a visualização
          console.error('Falha ao registrar visualização', e);
        }
      } catch (e) {
        console.error(e);
      }
    })();
  </script>
  <script src="scripts/header-session.js" defer></script>
</body>
</html>
